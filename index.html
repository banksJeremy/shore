<!doctype html>
<html lang=en>
	<head>
		<meta charset="utf-8">
		<title>Shore Math Engine</title>
		<link rel=stylesheet href=style.css>
		<script type="text/javascript" src="jquery-1.3.4.js"></script>
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
		<script type="text/javascript" src="mathjax/MathJax.js">
			MathJax.Hub.Config({
				extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
				jax: ["input/TeX", "output/HTML-CSS"],
				tex2jax: {
					inlineMath: [["\\(", "\\)"]],
					displayMath: [["\\[", "\\]"]]
				}
			})
		</script>
		<script type="text/javascript" src="coffeescript-0.9.4.js"></script>
		<script type="text/coffeescript">$ -> # jQuery on DOM ready...
			emPixels = ((element) ->
				"The approximate number of pixels per em in an element."
				
				test_element = $("<div>").css width: "10em"
				test_element.appendTo(element)
				result = parseFloat(test_element.css("width")) / 10
				test_element.remove()
				result
			) $("body") # this element
			
			occurences = (string, target_character) ->
				"The number of occurrences of a given character in a string."
				
				result = 0
				for character in string
					if character == target_character
						result += 1
				result
			
			scale_textarea = (textarea, modifier) ->
				"Set the height of a jQ textarea based on the newlines contained.
				
				(2 + newlines) ems."
				
				modifier ?= 0
				
				ems = occurences(textarea.val(), "\n") + 2 + modifier
				
				textarea.css "height", ems * emPixels
			
			input_box = $("#input")
			result_box = $("#results")
			form = $("form")
			
			input_box.focus()
			
			input_box.keypress (event) ->
				if event.which == 13 or event.which == 10
					if event.shiftKey
						$("form").submit()
						false
					else
						scale_textarea input_box, +1
						# where it most needs to be snappy
			
			input_box.keyup (event) -> scale_textarea input_box
			
			form.submit ->
				result_box.text "\\[" + $("#input").val() + "\\]"
				MathJax.Hub.Queue ["Typeset", MathJax.Hub, $(".result").get(0)]
				false # prevent form from being submitted normally
		</script>
	</head>
	<body>
		<div class=centering>
			<div class="content box">
				<h1>
					Shore <span>Math Engine</span>
				</h1>
				
				<form>
					<textarea id=input name=i></textarea>
					<div class=buttons>
						<input type=submit class=submit value="Calculate">
					</div>
				</form>
			</div>
			<div class="result box" id="results"></div>
			
			<div class=footer>
				Shore is developed by <a href="mailto:jeremy@jeremybanks.ca">Jeremy Banks</a>, the source and full credits are on <a href="http://github.com/jeremybanks/shore">on GitHub</a>.
			</div>
		</div>
	</body>
</html>
